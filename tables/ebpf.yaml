module_name: ebpf_decoder
input: 64
output:
  - type_name: "decode_out_t"
  - fields:
      [
        "alu",
        "rs1",
        "rs2",
        "imm",
        "rd",
        "pc",
        "load",
        "store",
        "lsu",
        "add",
        "sub",
        "land",
        "lor",
        "lxor",
        "sll",
        "sra",
        "srl",
        "slt",
        "unsign",
        "condbr",
        "beq",
        "bne",
        "bge",
        "blt",
        "bgt",
        "jal",
        "by",
        "half",
        "word",
        "mul",
        "rs1_sign",
        "rs2_sign",
        "low",
        "divu",
        "remu",
        "nop",
        "legal",
        "offset",
        "atomic",
        "call",
        "exit",
        "arsh",
      ]
decodes:
  # NOP instruction
  #- instr: "nop"
  #  match: "0000000000000000000000000000000000000000000000000000000000000000"
  #  decodes: ["nop", "legal"]
  
  # Exit instruction
  - instr: "exit"
    match: "1001011100000000000000000000000000000000000000000000000000000000"
    decodes: ["exit", "legal"]
  
  # Arithmetic Instructions (64-bit, immediate)
  - instr: "dst += imm"
    match: "................................0000000000000000....000000000111"
    decodes: ["alu", "add", "rs1", "imm", "rd", "legal"]
  - instr: "dst -= imm"
    match: "................................0000000000000000....000000010111"
    decodes: ["alu", "sub", "rs1", "imm", "rd", "legal"]
  - instr: "dst *= imm"
    match: "................................0000000000000000....000000100111"
    decodes: ["alu", "mul", "rs1", "imm", "rd", "legal"]
  - instr: "dst = (imm != 0) ? (dst / imm) : 0"
    match: "................................0000000000000000....000000110111"
    decodes: ["alu", "divu", "rs1", "imm", "rd", "legal"]
  - instr: "dst |= imm"
    match: "................................0000000000000000....000001000111"
    decodes: ["alu", "lor", "rs1", "imm", "rd", "legal"]
  - instr: "dst &= imm"
    match: "................................0000000000000000....000001010111"
    decodes: ["alu", "land", "rs1", "imm", "rd", "legal"]
  - instr: "dst <<= imm"
    match: "................................0000000000000000....000001100111"
    decodes: ["alu", "sll", "rs1", "imm", "rd", "legal"]
  - instr: "dst >>= imm (logical)"
    match: "................................0000000000000000....000001110111"
    decodes: ["alu", "srl", "rs1", "imm", "rd", "legal"]
  - instr: "dst >>= imm (arithmetic)"
    match: "................................0000000000000000....000011000111"
    decodes: ["alu", "sra", "rs1", "imm", "rd", "legal"]
  - instr: "dst ^= imm"
    match: "................................0000000000000000....000010100111"
    decodes: ["alu", "lxor", "rs1", "imm", "rd", "legal"]
  - instr: "dst = (imm != 0) ? (dst % imm) : dst"
    match: "................................0000000000000000....000010100111"
    decodes: ["alu", "remu", "rs1", "imm", "rd", "legal"]
  
  ## Arithmetic Instructions (64-bit, register)
  #- instr: "dst += src"
  #  match: "................0000000000000000................11110000"
  #  decodes: ["alu", "add", "rs1", "rs2", "rd", "legal"]
  #- instr: "dst -= src"
  #  match: "................0000000000000000................00001000"
  #  decodes: ["alu", "sub", "rs1", "rs2", "rd", "legal"]
  #- instr: "dst *= src"
  #  match: "................0000000000000000................10001000"
  #  decodes: ["alu", "mul", "rs1", "rs2", "rd", "legal"]
  #- instr: "dst /= src"
  #  match: "................0000000000000000................01001000"
  #  decodes: ["alu", "div", "rs1", "rs2", "rd", "legal"]
  #- instr: "dst |= src"
  #  match: "................0000000000000000................11001000"
  #  decodes: ["alu", "lor", "rs1", "rs2", "rd", "legal"]
  #- instr: "dst &= src"
  #  match: "................0000000000000000................00101000"
  #  decodes: ["alu", "land", "rs1", "rs2", "rd", "legal"]
  #- instr: "dst <<= src"
  #  match: "................0000000000000000................10101000"
  #  decodes: ["alu", "sll", "rs1", "rs2", "rd", "legal"]
  #- instr: "dst >>= src (logical)"
  #  match: "................0000000000000000................01101000"
  #  decodes: ["alu", "srl", "rs1", "rs2", "rd", "legal"]
  #- instr: "dst >>= src (arithmetic)"
  #  match: "................0000000000000000................11101000"
  #  decodes: ["alu", "sra", "rs1", "rs2", "rd", "legal"]
  #- instr: "dst ^= src"
  #  match: "................0000000000000000................00011000"
  #  decodes: ["alu", "lxor", "rs1", "rs2", "rd", "legal"]
  #- instr: "dst %= src"
  #  match: "................0000000000000000................10011000"
  #  decodes: ["alu", "mod", "rs1", "rs2", "rd", "legal"]
  #- instr: "dst = -dst"
  #  match: "................0000000000000000................01011000"
  #  decodes: ["alu", "neg", "rs1", "rd", "legal"]
  #- instr: "dst = src"
  #  match: "................0000000000000000................11011000"
  #  decodes: ["alu", "mov", "rs1", "rd", "legal"]